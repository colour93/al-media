# 简介

多维度的视频管理服务端程序，基于 bun + elysia + drizzle(pg-native) + ffmpeg(spawn)， 以指定资源库目录为事实，使用计算的 uniqueId 去重，智能元数据提取。

# 功能性需求

- 多维度: 创作者、发行方、演员等多维度信息数据
- 基于文件的事实: 类似资源库，索引视频文件，并使用相对低 IO 算法计算摘要
- 智能元数据提取: 使用大语言模型，从文件名尽可能多的提取出有效元信息
- 便捷元数据管理: 批量处理

# 需求详解

## 多维度

- 分别存储创作者、发行方、演员等信息
- 对于个人创作者，可以与演员关联
- 创作者、发行方、演员的任意一方标签，会在视频查询时绑定到视频上同步展示

## 基于文件的事实

- 维护文件目录表 `file_dirs`（唯一 `path`，可启停扫描），扫描器以目录为入口
- 文件入库写入 `video_files`: 包含 `videoId`、`fileDirId`、`fileKey`/路径、`uniqueId`、`fileSize`、`videoDuration` 等，支持一视频多文件（多码率/版本）
- 文件摘要 `uniqueId` 计算: 文件 头、25%、50%、75%、尾 各取 1MB，计算 hash，再拼接文件大小的 hash 后再次 hash
- 使用 ffmpeg(spawn) 生成缩略图与获取视频信息

## 智能元数据提取

- 使用大语言模型，从文件名尽可能多的提取出有效元信息
- 使用 function call，精准匹配已落库的数据

## 便捷元数据管理

- 支持批量管理，如打标签、设置创作者等信息